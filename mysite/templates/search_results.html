{% extends "layout.html" %}
{% block content %}
<style>
    .form-control {
        margin-top: 5px;
        max-width: 5%;
        margin-bottom: 10px;
        object-fit: contain;
    }
</style>
<div class="container">
    <header class="jumbotron my-4">
        <h1 class="display-3">Places in {{ location }} </h1>
    </header>

    <div id="accordion">
        <div class="card">
            <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                    <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Filters
                    </button>
                </h5>
            </div>
            <div id="collapseOne" class="collapse hide" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body">
                    <b> No. of Guests <br /></b>
                    <input type="number" id="num_guests" class="form-control form-control-sm" value="1" min="1">
                    <b> Maximum Price <br /></b>
                    <span id="priceDisplay"></span>
                    <input type="range" class="custom-range" id="priceRange" max="999">
                    <script>
                        var slider = document.getElementById("priceRange");
                        var output = document.getElementById("priceDisplay");
                        output.innerHTML = slider.value;

                        slider.oninput = function () {
                            output.innerHTML = this.value;
                        }
                    </script>
                    <b> Amenities<br /></b>
                    {% for a in amenities %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="{{ a.amenity_name }}">
                        <label class="form-check-label" for="inlineCheckbox1">{{ a.amenity_name }}</label>
                    </div>
                    {% endfor %}
                    <br />
                    <br />
                    <button class="btn btn-primary" id="filter" onclick="filterProperties()">Apply</button>
                </div>
            </div>
        </div>
    </div>
    <br />

    {% for p in properties %}
    <div class="container">
        <div id="prop_list" class="card" style="width:1050px">
            <div class="row">
                <div class="col-sm-6">
                    <img class="card-img" src="https://images.unsplash.com/photo-1475855581690-80accde3ae2b?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1950&q=80" alt="Card image" />
                </div>
                <div class="col-sm-6">
                    <div class="card-body-right">
                        <h4 class="card-title">{{ p.name }}</h4>
                        <p class="card-text">
                            Location: {{ p.location }}<br />
                            Room for: {{ p.size }} people<br />
                            Price: ${{ p.price }}<br />
                            {{ p.description }}
                        </p>
                        <a href="{% url 'property' p.property_id %}" class="btn btn-primary">Book</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br />
    {% empty %}
    No properties found.
    {% endfor %}
    <script>
        function filterProperties() {
            // Declare variables for filter requests and the property list
            var tr, i;
            num_guests = document.getElementById("num_guests").value;
            price = document.getElementById("priceRange").value;
            amenities = document.getElementsByClassName("form-check-input");
            validAmen = [];
            tr = document.getElementsByClassName("row");
            // Convert property list to JSON
            var pstring = '{{ prop_json|safe }}';
            var plist = JSON.parse(pstring);

            // Detect selected amenities
            for (a of amenities) {
                if (a.checked) {
                    validAmen.append(a);
                }
            }

            // Hide properties that do not satisfy filters
            for (var i = 0; i < plist.length; i++) {
                if (plist[i].size < num_guests) {
                    tr[i].style.display = "none";
                } else {
                    if (plist[i].price > price) {
                        tr[i].style.display = "none";
                    } else {
                        tr[i].style.display = "";
                    }
                }
            }
        }
    </script>
</div>

{% endblock %}
